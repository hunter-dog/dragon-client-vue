<script setup>
    import youtube from '@/assets/img/youtube.png';
    import insta from '@/assets/img/insta.png';

</script>

<template>
    <!-- <div class="q-pa-md example-row-equal-width">
        <h4>ÎÑ§Ïò§Ìô©Ï†úÏã†ÍªòÏÑú Ï§ò Ìå®Î≤ÑÎ¶∞ ÏÇ¨ÎûåÎì§</h4>
        <div class="row" v-for="(chunk, index) in chunkedCards" :key="index">
            <div class="col q-pa-md" v-for="person in chunk" :key="person.id">
                <q-card class="my-card" v-bind:class="{ 'invisible': person.id === -1 }">
                    <q-item>
                        <q-item-section avatar>
                            <q-avatar>
                                <img :src="person.logoUrl" alt="logo">
                            </q-avatar>
                        </q-item-section>
                        <q-item-section>
                            <q-item-label>{{ person.name }}</q-item-label>
                            <q-item-label caption>{{ person.speciality }}</q-item-label>
                        </q-item-section>

                        <q-item-label>
                            <a :href="person.snsUrl" target="_blank">
                                <img width="30px" :src="youtube">
                            </a>
                        </q-item-label>
                    </q-item>

                    <img :src="person.thumbnailUrl" alt="ÎåÄÌëúÏù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§.">

                    <q-card-actions class="space-evenly">
                        <q-btn flat @click="addLikes(person.id)">
                            <div>
                                <q-icon name="thumb_up" color="blue" /><br>
                                <span>Í∞úÏ∂î</span><br>                      
                                <span>({{ person.likes }})</span>      
                            </div>
                        </q-btn>
                        
                        <q-btn flat @click="addDislikes(person.id)">
                            <div>
                                <q-icon name="thumb_down" color="red" /><br>
                                <span>ÎπÑÏ∂î</span><br>
                                <span>({{ person.dislikes }})</span>                                
                            </div>
                        </q-btn>
                    </q-card-actions>
                </q-card>
            </div>
        </div>
    </div> -->

    <div class="q-pa-md example-row-equal-width">
        <span class="q-pa-md font-big">üêâ ÎìúÎûòÍ≥§ ÎãàÏ≤¥Ïùò Ïû¨Î¶º ÎåÄÏ∞¨Ïö∞ Ïó∞Ìï© üêâ</span>
        <div class="row">
            <div v-bind:class="dynamicColumn + ' q-pa-md'" v-for="person in teamDaragon" :key="person.id">
                <q-card class="my-card" v-bind:class="{ 'invisible': person.id === -1 }">
                    <q-item>
                        <q-item-section avatar>
                            <q-avatar>
                                <img :src="person.logoUrl" alt="logo">
                            </q-avatar>
                        </q-item-section>
                        <q-item-section>
                            <q-item-label>{{ person.name }}</q-item-label>
                            <q-item-label caption>{{ person.speciality }}</q-item-label>
                        </q-item-section>

                        <q-item-label>
                            <a :href="person.snsUrl" target="_blank">
                                <img width="30px" :src="youtube">    
                            </a>
                        </q-item-label>
                    </q-item>

                    <img :src="person.thumbnailUrl" alt="ÎåÄÌëúÏù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§.">

                    <q-card-actions class="space-evenly">
                        <q-btn flat @click="addLikes(person.id)">
                            <div>
                                <q-icon name="thumb_up" color="blue" /><br>
                                <span>Í∞úÏ∂î</span><br>                      
                                <span>({{ person.likes }})</span>      
                            </div>
                        </q-btn>
                        
                        <q-btn flat @click="addDislikes(person.id)">
                            <div>
                                <q-icon name="thumb_down" color="red" /><br>
                                <span>ÎπÑÏ∂î</span><br>
                                <span>({{ person.dislikes }})</span>                                
                            </div>
                        </q-btn>
                    </q-card-actions>
                </q-card>
            </div>
        </div>

    
        <span class="q-pa-md font-big">üßç ÎÑ§Ïò§Ìô©Ï†úÏã†Í≥º Ï†ëÏ¥âÏù¥ ÏûàÏóàÎçò NPC Î™ÖÎ∂Ä üßç</span>
        <div class="row">
            <div v-bind:class="dynamicColumn + ' q-pa-md'" v-for="person in yongniverse" :key="person.id">
                <q-card class="my-card" v-bind:class="{ 'invisible': person.id === -1 }">
                    <q-item>
                        <q-item-section avatar>
                            <q-avatar>
                                <img :src="person.logoUrl" alt="logo">
                            </q-avatar>
                        </q-item-section>
                        <q-item-section>
                            <q-item-label>{{ person.name }}</q-item-label>
                            <q-item-label caption>{{ person.speciality }}</q-item-label>
                        </q-item-section>

                        <q-item-label>
                            <a :href="person.snsUrl" target="_blank">
                                <template v-if="person.snsUrl.includes('youtube')">
                                    <img width="30px" :src="youtube">    
                                </template>
                                <template v-if="person.snsUrl.includes('insta')">
                                    <img width="30px" :src="insta">    
                                </template>
                            </a>
                        </q-item-label>
                    </q-item>

                    <img :src="person.thumbnailUrl" alt="ÎåÄÌëúÏù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§.">

                    <q-card-actions class="space-evenly">
                        <q-btn flat @click="addLikes(person.id)">
                            <div>
                                <q-icon name="thumb_up" color="blue" /><br>
                                <span>Í∞úÏ∂î</span><br>                      
                                <span>({{ person.likes }})</span>      
                            </div>
                        </q-btn>
                        
                        <q-btn flat @click="addDislikes(person.id)">
                            <div>
                                <q-icon name="thumb_down" color="red" /><br>
                                <span>ÎπÑÏ∂î</span><br>
                                <span>({{ person.dislikes }})</span>                                
                            </div>
                        </q-btn>
                    </q-card-actions>
                </q-card>
            </div>
        </div>
    </div>

</template>

<script>
    import {apiCall} from '@/util/apiCall.js';
    import { API_LIST } from '@/constants/apiList.js';

    export default {
        data() {
            return {
                yongniverse: [],
                teamDaragon: [],
                windowWidth: window.innerWidth,
            }
        },
        mounted() {
            this.getYongniverse();
            window.addEventListener('resize', this.handleResize);
        },
        beforeDestroy() {
            window.removeEventListener('resize', this.handleResize);
        },
        methods: {
            handleResize() {
                this.windowWidth = window.innerWidth;
            },
            getYongniverse() {            
                this.getNpcList();
                this.getTeamDragon();
            },
            async getNpcList() {
                const result = await apiCall(API_LIST.GET_YONGNIVERSE);
                if (result.status) {
                    this.yongniverse = result.data;
                }
            },
            async getTeamDragon() {
                const result = await apiCall(API_LIST.GET_YONGNIVERSE_TEAM_DRAGON);
                if (result.status) {
                    this.teamDaragon = result.data;
                }
            },
            async addLikes(id) {
                const parameters = {
                    isLike: true,
                    id,
                    tableName: 'yongniverse'
                };

                const result = await apiCall(API_LIST.ADD_YONGNIVERSE_LIKES, parameters); 
                if (result.status) {

                    let person = this.yongniverse.find((person) => {
                        return person.id === id;
                    });
                    if (!person) {
                        person = this.teamDaragon.find((person) => {
                            return person.id === id;
                        });
                    }
                    person.likes = result.data.likes;
                } else {
                    alert(result.message);
                }
            },
            async addDislikes(id) {
                const parameters = {
                    isLike: false,
                    id,
                    tableName: 'yongniverse'
                };

                const result = await apiCall(API_LIST.ADD_YONGNIVERSE_DISLIKES, parameters); 
                if (result.status) {
                    let person = this.yongniverse.find((person) => {
                        return person.id === id;
                    });
                    if (!person) {
                        person = this.teamDaragon.find((person) => {
                            return person.id === id;
                        });
                    }
                    person.dislikes = result.data.dislikes;
                } else {
                    alert(result.message);
                }

                

            }
        },
        computed: {
            chunkedCards() {
                let chunks = [];
                for (let i = 0; i < this.yongniverse.length; i += 5) {
                    const newChunk = this.yongniverse.slice(i, i + 5);
                    if (newChunk.length < 5) {
                        const countOfFakeCards = 5 - newChunk.length;
                        for (let i=0; i < countOfFakeCards; i++) {
                            const fakeCard = {
                                id: -1,
                            }
                            newChunk.push(fakeCard);
                        }
                    }
                    chunks.push(newChunk);
                }
                return chunks;
            },
            dynamicColumn() {
                if (this.windowWidth >= 1200) {
                    return 'col-3';
                } else if (this.windowWidth >= 992) {
                    return 'col-4';
                } else if (this.windowWidth >= 768) {
                    return 'col-6';
                } else {
                    return 'col-12';
                }
            },
           
        }
    }
</script>

<style scoped>
    .space-evenly {
        justify-content: space-evenly;
    }

    .font-big {
        font-size: 25px;   
    }
</style>